
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Analysing real data sets &#8212; Python for health data science.</title>
    
  <link rel="stylesheet" href="../../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.c441f2ba0852f4cabcb80105e3a46ae6.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.d3f166471bb80abb5163.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Case study: Combining multiple sources" href="06_cs_combining.html" />
    <link rel="prev" title="Managing time series" href="04_datetimes.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/title_cropped.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Python for health data science.</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../front_page.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Data and software
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/git.html">
   GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/conda.html">
   Conda virtual environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/docker.html">
   Docker
  </a>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Algorithms and computational modelling
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01_algorithms/01_design.html">
   The importance of design
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/01_design/01_primes.html">
     Computing prime numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/01_design/01_primes.html#a-more-efficient-algorithm">
     A more efficient algorithm
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/01_design/02_better_design.html">
     Improving the prime sieve code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/01_design/03_micro_opt.html">
     Do micro-optimisations matter?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/01_design/04_summing_up.html">
     Summing up
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01_algorithms/02_oop.html">
   Designing using objects
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/02_oop/01_python_classes.html">
     A world of objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/02_oop/02_oop_sim.html">
     Case study: ABS
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01_algorithms/03_numpy.html">
   Scientific coding in
   <code class="docutils literal notranslate">
    <span class="pre">
     numpy
    </span>
   </code>
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/01_performance.html">
     Arrays versus lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/02_vectors.html">
     Vectors and matricies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/03_slicing.html">
     Array slicing and indexing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/04_algebra.html">
     Array algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/05_statistics.html">
     Statistical procedures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/06_sampling.html">
     Random variables and simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/07_advanced_iter.html">
     Advanced Array Iteration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/08_cs1.html">
     Case study 1: a bootstrap routine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/09_cs2.html">
     Case study 2: prime sieve
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/03_numpy/10_cs3.html">
     Case study 3: online statistics
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01_algorithms/04_exercises.html">
   Exercises
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/04_exercises/01_science_funcs.html">
     Coding scientific functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/04_exercises/02_array.html">
     Working with an
     <code class="docutils literal notranslate">
      <span class="pre">
       np.ndarray
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/04_exercises/03_int_numpy.html">
     Intermediate NumPy
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../01_algorithms/05_debug.html">
   Debug challenges
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../01_algorithms/05_debug/01_debug_numpy.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       numpy
      </span>
     </code>
     debug
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Statistical Programming
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="../01_pandas_front_page.html">
   Data wrangling
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="01_intro_pandas.html">
     Introduction to
     <strong>
      <code class="docutils literal notranslate">
       <span class="pre">
        pandas
       </span>
      </code>
     </strong>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_files.html">
     Working with files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_non_standard_download.html">
     Case study: a large remote dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04_datetimes.html">
     Managing time series
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Analysing real data sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06_cs_combining.html">
     Case study: Combining multiple sources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../02_visual_front_page.html">
   Visualising data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../02_matplotlib/01_matplotlib.html">
     Introduction to
     <code class="docutils literal notranslate">
      <span class="pre">
       Matplotlib
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_matplotlib/02_matplotlib2.html">
     Multiple subplots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_matplotlib/03_cs_hm.html">
     Case study: heat map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02_matplotlib/02_plotting_time_series.html">
     Case Study: ED Time Series
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../03_exercises_front_page.html">
   Exercises
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../03_exercises/00_dataframes.html">
     Working with a
     <code class="docutils literal notranslate">
      <span class="pre">
       pandas.Dataframe
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_exercises/01_data_wrangling_matplotlib.html">
     ED data wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_exercises/02_stroke_data_wrangling.html">
     Stroke data wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_exercises/03_visualise_ts.html">
     Visualising time series data
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../04_solutions_front_page.html">
   Solutions
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../04_solutions/00_dataframes.html">
     Working with a
     <code class="docutils literal notranslate">
      <span class="pre">
       pandas.Dataframe
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_solutions/01_data_wrangling_matplotlib_solutions.html">
     ED Data Wrangling Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_solutions/02_stroke_data_wrangling_solutions.html">
     Stroke data wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_solutions/03_visualise_ts_SOLUTIONS.html">
     Visualising time series data
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Managing Data Science Projects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../03_mgt/03_vc_front_page.html">
   Version control
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/02_git.html">
     Introducing Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/03_cs_1.html">
     Case study: Basic use of Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/04_cs_2.html">
     Case study: roll back and bug fix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/05_cs_3.html">
     Case study: Branching and merging
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../03_mgt/03_mgt_front_page.html">
   Deployment
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/02_packaging/01_python_packages.html">
     Local python packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/03_pypi/01_pypi.html">
     PyPi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_binder/01_binder.html">
     BinderHub
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../03_mgt/04_exercises_front_page.html">
   Exercises
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_exercises/01_python_packages.html">
     Python package exercise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_exercises/02_conda.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       conda
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_exercises/03_binder.html">
     Binderhub exercises
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../03_mgt/05_solutions_front_page.html">
   Solutions
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/05_solutions/01_python_packages_solutions.html">
     Python package exercise
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>
<p class="caption collapsible-parent" role="heading">
 <span class="caption-text">
  Appendix - Basic Python
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../appendix/fp_lectures.html">
   Lectures
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/lectures/Lecture1.html">
     Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/lectures/Lecture2.html">
     Conditionals and Loops
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../appendix/fp_practicals.html">
   Practicals
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/01_basics.html">
     Basic Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/debug1.html">
     Debug challenge 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/02_basics.html">
     Conditionals and Loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/debug2.html">
     Debug challenge 2
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/02_stat_prog/01_pandas/05_analysing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/health-data-science-OR/coding-for-ml"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/health-data-science-OR/coding-for-ml/issues/new?title=Issue%20on%20page%20%2Fcontent/02_stat_prog/01_pandas/05_analysing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/health-data-science-OR/coding-for-ml/main?urlpath=lab/tree/content/02_stat_prog/01_pandas/05_analysing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/health-data-science-OR/coding-for-ml/blob/main/content/02_stat_prog/01_pandas/05_analysing.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-slight-clean-up-of-the-dataset">
   A slight clean-up of the dataset
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#translating-dutch-column-names-and-categories-to-english">
     Translating Dutch Column Names and Categories to English
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recoding-nan">
     Recoding
     <code class="docutils literal notranslate">
      <span class="pre">
       NaN
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correcting-the-data-type-of-columns">
     Correcting the data type of columns
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pulling-it-together-in-a-single-function">
     Pulling it together in a single function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#method-chaining-implementation">
     Method chaining implementation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualising-the-number-of-cases-over-time">
   Visualising the number of cases over time.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#but-first-more-wrangling">
     But first…. more wrangling!
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="analysing-real-data-sets">
<h1>Analysing real data sets<a class="headerlink" href="#analysing-real-data-sets" title="Permalink to this headline">¶</a></h1>
<p>Let’s take a look at some of the analysis and visualisation functionality built into <code class="docutils literal notranslate"><span class="pre">pandas</span></code>. We will work with a real dataset.  The dataset describes COVID-19 cases, hosptialisation and deaths in the Netherlands between Feb and Nov 2020. The dataset is part of a larger public dataset published under a CC-BY 4.0 license. To see the source follow the link below:</p>
<blockquote>
<div><p>De Bruin, J, Voorvaart, R, Menger, V, Kocken, I, &amp; Phil, T. (2020). Novel Coronavirus (COVID-19) Cases in The Netherlands (Version v2020.11.17) [Data set]. Zenodo. <a class="reference external" href="http://doi.org/10.5281/zenodo.4278891">http://doi.org/10.5281/zenodo.4278891</a></p>
</div></blockquote>
<p>We will use this dataset to put into practice some of existing <code class="docutils literal notranslate"><span class="pre">pandas</span></code> skills and also learn a few new tools to help us understand and visualise the data.</p>
<p>The first actions we will take are importing <code class="docutils literal notranslate"><span class="pre">numpy</span></code> and <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, read in the dataset and have a look at the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATA_URL</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/health-data-science-OR/&#39;</span> \
            <span class="o">+</span> <span class="s1">&#39;hpdm139-datasets/main/RIVM_NL_provincial.csv&#39;</span>
<span class="n">neth_covid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_URL</span><span class="p">)</span>
<span class="n">neth_covid</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10335 entries, 0 to 10334
Data columns (total 6 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   Datum             10335 non-null  object 
 1   Provincienaam     9540 non-null   object 
 2   Provinciecode     10335 non-null  int64  
 3   Type              10335 non-null  object 
 4   Aantal            9906 non-null   float64
 5   AantalCumulatief  9945 non-null   float64
dtypes: float64(2), int64(1), object(3)
memory usage: 484.6+ KB
</pre></div>
</div>
</div>
</div>
<p>The meta data summary of the <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> provides useful information.  Firstly, we can see that a number of fields have missing data.  Secondly, the column names are in Dutch.</p>
<ul class="simple">
<li><p>Datum = date</p></li>
<li><p>Provincienaam = Province name e.g. ‘Gronigen’</p></li>
<li><p>Provinciecode = Province code integer</p></li>
<li><p>Aantal = number</p></li>
<li><p>AantalCumulatief = cumulative number</p></li>
</ul>
<p>Let’s take a peek at the head and tail of the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Datum</th>
      <th>Provincienaam</th>
      <th>Provinciecode</th>
      <th>Type</th>
      <th>Aantal</th>
      <th>AantalCumulatief</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>Overleden</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>Totaal</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>Ziekenhuisopname</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>Overleden</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>Totaal</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Datum</th>
      <th>Provincienaam</th>
      <th>Provinciecode</th>
      <th>Type</th>
      <th>Aantal</th>
      <th>AantalCumulatief</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10330</th>
      <td>2020-11-17</td>
      <td>Noord-Brabant</td>
      <td>30</td>
      <td>Totaal</td>
      <td>847.0</td>
      <td>71925.0</td>
    </tr>
    <tr>
      <th>10331</th>
      <td>2020-11-17</td>
      <td>Noord-Brabant</td>
      <td>30</td>
      <td>Ziekenhuisopname</td>
      <td>7.0</td>
      <td>3319.0</td>
    </tr>
    <tr>
      <th>10332</th>
      <td>2020-11-17</td>
      <td>Limburg</td>
      <td>31</td>
      <td>Overleden</td>
      <td>0.0</td>
      <td>842.0</td>
    </tr>
    <tr>
      <th>10333</th>
      <td>2020-11-17</td>
      <td>Limburg</td>
      <td>31</td>
      <td>Totaal</td>
      <td>266.0</td>
      <td>21253.0</td>
    </tr>
    <tr>
      <th>10334</th>
      <td>2020-11-17</td>
      <td>Limburg</td>
      <td>31</td>
      <td>Ziekenhuisopname</td>
      <td>2.0</td>
      <td>1743.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Our peeking has again revealed some useful information.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Provincienaam</span></code> is <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (Not a Number i.e. missing) when the reporting the overall totals across all provinces.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Aantal</span></code> and <code class="docutils literal notranslate"><span class="pre">AantalCumulatief</span></code> record <code class="docutils literal notranslate"><span class="pre">NaN</span></code> in early parts of the pandemic dataset when no cases are being reported.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Type</span></code> is a categorical column with three categories in Dutch. Approximate translations are:</p>
<ul>
<li><p>Totaal = total (positive cases)</p></li>
<li><p>Ziekenhuisopname = hospital admissions</p></li>
<li><p>Overleden = deaths attributable to COVID19</p></li>
</ul>
</li>
</ul>
<section id="a-slight-clean-up-of-the-dataset">
<h2>A slight clean-up of the dataset<a class="headerlink" href="#a-slight-clean-up-of-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>Now that we have had a look at the raw data let’s use <code class="docutils literal notranslate"><span class="pre">pandas</span></code> perform a small clean-up operation that will make our life much easier when we get to analysis.  We will firstly break this procedure down into discrete steps and pull that together is a function.  I’ll then show you an alternative cool way of organising your <code class="docutils literal notranslate"><span class="pre">pandas</span></code> using <strong>method chaining</strong>.</p>
<section id="translating-dutch-column-names-and-categories-to-english">
<h3>Translating Dutch Column Names and Categories to English<a class="headerlink" href="#translating-dutch-column-names-and-categories-to-english" title="Permalink to this headline">¶</a></h3>
<p>Let’s translate the header columns first.  That’s relatively simple as we just replace the list of existing headers with their translations.  We will also update <code class="docutils literal notranslate"><span class="pre">type</span></code> to <code class="docutils literal notranslate"><span class="pre">metric</span></code> as that is more descriptive of the data that the column actually holds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">translated_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Datum&#39;</span><span class="p">:</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;Provincienaam&#39;</span><span class="p">:</span><span class="s1">&#39;province&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;Provinciecode&#39;</span><span class="p">:</span><span class="s1">&#39;province_code&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;Type&#39;</span><span class="p">:</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;Aantal&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;AantalCumulatief&#39;</span><span class="p">:</span><span class="s1">&#39;n_cum&#39;</span><span class="p">}</span>

<span class="n">neth_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">translated_names</span><span class="p">)</span>
<span class="n">neth_covid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>province</th>
      <th>province_code</th>
      <th>metric</th>
      <th>n</th>
      <th>n_cum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>Overleden</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>Totaal</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>Ziekenhuisopname</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>Overleden</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>Totaal</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>To recode the <code class="docutils literal notranslate"><span class="pre">metric</span></code> column we can use the <code class="docutils literal notranslate"><span class="pre">.apply(&lt;function&gt;)</span></code> method.  This applies a function to each row in the <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>.  It only makes sense to do this for the <code class="docutils literal notranslate"><span class="pre">metric</span></code> column so we need to be careful about what data we pass in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is a tiered dict {col_name:{dutch key :english value}}</span>
<span class="n">translations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Overleden&#39;</span><span class="p">:</span><span class="s1">&#39;deaths&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Totaal&#39;</span><span class="p">:</span><span class="s1">&#39;total_cases&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Ziekenhuisopname&#39;</span><span class="p">:</span><span class="s1">&#39;hosp_admit&#39;</span><span class="p">}}</span>

<span class="n">neth_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">translations</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>province</th>
      <th>province_code</th>
      <th>metric</th>
      <th>n</th>
      <th>n_cum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>deaths</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>total_cases</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-02-27</td>
      <td>NaN</td>
      <td>-1</td>
      <td>hosp_admit</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>deaths</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>total_cases</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="recoding-nan">
<h3>Recoding <code class="docutils literal notranslate"><span class="pre">NaN</span></code><a class="headerlink" href="#recoding-nan" title="Permalink to this headline">¶</a></h3>
<p>The early case numbers are set to <code class="docutils literal notranslate"><span class="pre">NaN</span></code> as opposed to zero.  The column <code class="docutils literal notranslate"><span class="pre">province</span></code> is always <code class="docutils literal notranslate"><span class="pre">NaN</span></code> when it is reporting the total for all provinces.  Let’s update that to <code class="docutils literal notranslate"><span class="pre">overall</span></code>.</p>
<p>To do this we can make use of the <code class="docutils literal notranslate"><span class="pre">.fillna</span></code> method.  We can replace the different fields in one go by passing in a dict that contains a list of column name keys and replacement values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recoding</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_cum&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;province&#39;</span><span class="p">:</span> <span class="s1">&#39;overall&#39;</span><span class="p">}</span>
<span class="n">neth_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">recoding</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>province</th>
      <th>province_code</th>
      <th>metric</th>
      <th>n</th>
      <th>n_cum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-27</td>
      <td>overall</td>
      <td>-1</td>
      <td>deaths</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02-27</td>
      <td>overall</td>
      <td>-1</td>
      <td>total_cases</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-02-27</td>
      <td>overall</td>
      <td>-1</td>
      <td>hosp_admit</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>deaths</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>total_cases</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="correcting-the-data-type-of-columns">
<h3>Correcting the data type of columns<a class="headerlink" href="#correcting-the-data-type-of-columns" title="Permalink to this headline">¶</a></h3>
<p>The changes we want to make are:</p>
<ol class="simple">
<li><p>Convert <code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">n_cum</span></code> from floats to integer data types (as it is count data)</p></li>
<li><p>Set<code class="docutils literal notranslate"><span class="pre">date</span></code> to a proper data time field.</p></li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">metric</span></code> to a <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> field (as it only contains three types of category).</p></li>
</ol>
<blockquote>
<div><p>Why bother setting <code class="docutils literal notranslate"><span class="pre">metric</span></code> to have the <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> datatype?  For one thing it slightly reduces memory requirements.  But for me the main benefit is that it tells another third party code, particularly code that is used for plotting, that the field is categorical and should be treated differently.</p>
</div></blockquote>
<p>For casting data types a <code class="docutils literal notranslate"><span class="pre">pandas.Dataframe</span></code> includes the <code class="docutils literal notranslate"><span class="pre">.astype</span></code> method.  This accepts a dict that contains column name keys and datatype values.  Here we will cast to <code class="docutils literal notranslate"><span class="pre">np.int32</span></code>.  The function returns an updated copy of the dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># change datatype of column</span>
<span class="n">neth_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="s1">&#39;n_cum&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>We can deal with the <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">metric</span></code> columns in one step using the <code class="docutils literal notranslate"><span class="pre">.assign</span></code> method.  The method creates new columns, but you can also use it to overwrite existing ones. The syntax might take a bit of getting used to if you are unfamiliar with <strong>lambda expressions</strong> in python.</p>
<p>For those who are unfamilar a lambda expression is an annoymous function: a function without a name.  Typically they are very simple and used inline within some other code. For example, here is a annoymous function with parameters <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> that returns the product.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span>
</pre></div>
</div>
<blockquote>
<div><p>Note that the parameters come before the semi-colon and the function logic afterwards.</p>
</div></blockquote>
<p>But like normal functions they are first class objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># some other operations and code</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span>
</pre></div>
</div>
<p>For our purposes in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> we can use it to create a new column.  Here the parameter <code class="docutils literal notranslate"><span class="pre">x</span></code> is actually the <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code>.  So to access the <code class="docutils literal notranslate"><span class="pre">date</span></code> column we use <code class="docutils literal notranslate"><span class="pre">x['date']</span></code> rather than <code class="docutils literal notranslate"><span class="pre">neth_covid['date']</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>To <code class="docutils literal notranslate"><span class="pre">assign</span></code> more than one colunm add another annoymous function.  The below overwrites <code class="docutils literal notranslate"><span class="pre">date</span></code> and <code class="docutils literal notranslate"><span class="pre">metric</span></code> with updated columns based on the old values.</p>
<blockquote>
<div><p>If we wanted to create new columns we would use a different column name.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]),</span>
                               <span class="n">metric</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]))</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>province</th>
      <th>province_code</th>
      <th>metric</th>
      <th>n</th>
      <th>n_cum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10330</th>
      <td>2020-11-17</td>
      <td>Noord-Brabant</td>
      <td>30</td>
      <td>total_cases</td>
      <td>847</td>
      <td>71925</td>
    </tr>
    <tr>
      <th>10331</th>
      <td>2020-11-17</td>
      <td>Noord-Brabant</td>
      <td>30</td>
      <td>hosp_admit</td>
      <td>7</td>
      <td>3319</td>
    </tr>
    <tr>
      <th>10332</th>
      <td>2020-11-17</td>
      <td>Limburg</td>
      <td>31</td>
      <td>deaths</td>
      <td>0</td>
      <td>842</td>
    </tr>
    <tr>
      <th>10333</th>
      <td>2020-11-17</td>
      <td>Limburg</td>
      <td>31</td>
      <td>total_cases</td>
      <td>266</td>
      <td>21253</td>
    </tr>
    <tr>
      <th>10334</th>
      <td>2020-11-17</td>
      <td>Limburg</td>
      <td>31</td>
      <td>hosp_admit</td>
      <td>2</td>
      <td>1743</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="pulling-it-together-in-a-single-function">
<h3>Pulling it together in a single function<a class="headerlink" href="#pulling-it-together-in-a-single-function" title="Permalink to this headline">¶</a></h3>
<p>In summary, we have put together a simple dataset cleaning process in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.  Let’s tidy up our code and put it all in a single function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clean_covid_dataset</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Helper function to clean the netherlands covid dataset.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    csv_path: str</span>
<span class="sd">        Path or URL to Comman Seperated Value file containing Dutch Covid data.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    pd.Dataframe</span>
<span class="sd">        Cleaned Covid19 dataset.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">translated_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Datum&#39;</span><span class="p">:</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Provincienaam&#39;</span><span class="p">:</span><span class="s1">&#39;province&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Provinciecode&#39;</span><span class="p">:</span><span class="s1">&#39;province_code&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Type&#39;</span><span class="p">:</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Aantal&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;AantalCumulatief&#39;</span><span class="p">:</span><span class="s1">&#39;n_cum&#39;</span><span class="p">}</span>

    <span class="n">translated_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Overleden&#39;</span><span class="p">:</span><span class="s1">&#39;deaths&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Totaal&#39;</span><span class="p">:</span><span class="s1">&#39;total_cases&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Ziekenhuisopname&#39;</span><span class="p">:</span><span class="s1">&#39;hosp_admit&#39;</span><span class="p">}}</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">translated_names</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">translated_metrics</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_cum&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;province&#39;</span><span class="p">:</span> <span class="s1">&#39;overall&#39;</span><span class="p">})</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="s1">&#39;n_cum&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">})</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]),</span>
                   <span class="n">metric</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]))</span>    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test</span>
<span class="n">neth_covid</span> <span class="o">=</span> <span class="n">clean_covid_dataset</span><span class="p">(</span><span class="n">DATA_URL</span><span class="p">)</span>
<span class="n">neth_covid</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10335 entries, 0 to 10334
Data columns (total 6 columns):
 #   Column         Non-Null Count  Dtype         
---  ------         --------------  -----         
 0   date           10335 non-null  datetime64[ns]
 1   province       10335 non-null  object        
 2   province_code  10335 non-null  int64         
 3   metric         10335 non-null  category      
 4   n              10335 non-null  int32         
 5   n_cum          10335 non-null  int32         
dtypes: category(1), datetime64[ns](1), int32(2), int64(1), object(1)
memory usage: 333.3+ KB
</pre></div>
</div>
</div>
</div>
</section>
<section id="method-chaining-implementation">
<h3>Method chaining implementation<a class="headerlink" href="#method-chaining-implementation" title="Permalink to this headline">¶</a></h3>
<p>The above solution for cleaning the dataset works fine.  However, we can modify our code slightly and (depending on who you ask) make it more elegant and readable using <strong>method chaining</strong>.</p>
<p>You should notice a pattern in our original <code class="docutils literal notranslate"><span class="pre">clean_covid_dataset</span></code> function.  We repeatedly perform an operation and return a new version of the dataset.  For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read CSV data and return as dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># rename columns and return new dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">translated_names</span><span class="p">)</span>

<span class="c1"># replace dutch with english words and return new dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">translated_metrics</span><span class="p">)</span>
</pre></div>
</div>
<p>Method chaining means that we don’t need to actually to include the <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">=</span> <span class="pre">df.</span></code> in each line of the code listing above.  We would instead replace it with the more elegant</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">translated_names</span><span class="p">)</span>
        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">translated_metrics</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>
</div>
<p>Note that we enclose the chained methods within <code class="docutils literal notranslate"><span class="pre">(</span></code> and <code class="docutils literal notranslate"><span class="pre">)</span></code>.  We also don’t need to include the <code class="docutils literal notranslate"><span class="pre">df</span></code> infront of <code class="docutils literal notranslate"><span class="pre">.rename</span></code> and <code class="docutils literal notranslate"><span class="pre">.replace</span></code>.</p>
<p>If we used method chaining our <code class="docutils literal notranslate"><span class="pre">clean_covid_dataset</span></code> function becomes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">clean_covid_dataset</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Helper function to clean the netherlands covid dataset.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    csv_path: str</span>
<span class="sd">        Path to Dutch Covid CSV file</span>
<span class="sd">    &#39;&#39;&#39;</span>    
    
    <span class="n">translated_names</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Datum&#39;</span><span class="p">:</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Provincienaam&#39;</span><span class="p">:</span><span class="s1">&#39;province&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Provinciecode&#39;</span><span class="p">:</span><span class="s1">&#39;province_code&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Type&#39;</span><span class="p">:</span><span class="s1">&#39;metric&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Aantal&#39;</span><span class="p">:</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;AantalCumulatief&#39;</span><span class="p">:</span><span class="s1">&#39;n_cum&#39;</span><span class="p">}</span>

    <span class="n">translated_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Overleden&#39;</span><span class="p">:</span><span class="s1">&#39;deaths&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Totaal&#39;</span><span class="p">:</span><span class="s1">&#39;total_cases&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;Ziekenhuisopname&#39;</span><span class="p">:</span><span class="s1">&#39;hosp_admit&#39;</span><span class="p">}}</span>
    
    <span class="c1"># method chaining solution.  Can be more readable</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">translated_names</span><span class="p">)</span>
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">translated_metrics</span><span class="p">)</span>
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n_cum&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;province&#39;</span><span class="p">:</span> <span class="s1">&#39;overall&#39;</span><span class="p">})</span>
            <span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="s1">&#39;n_cum&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">})</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]),</span>
                    <span class="n">metric</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">]))</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">neth_covid</span> <span class="o">=</span> <span class="n">clean_covid_dataset</span><span class="p">(</span><span class="n">DATA_URL</span><span class="p">)</span>
<span class="n">neth_covid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>province</th>
      <th>province_code</th>
      <th>metric</th>
      <th>n</th>
      <th>n_cum</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-27</td>
      <td>overall</td>
      <td>-1</td>
      <td>deaths</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02-27</td>
      <td>overall</td>
      <td>-1</td>
      <td>total_cases</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-02-27</td>
      <td>overall</td>
      <td>-1</td>
      <td>hosp_admit</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>deaths</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-27</td>
      <td>Groningen</td>
      <td>20</td>
      <td>total_cases</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It is up to you how you implement your <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.  Personally I think method chaining produces quite readable <code class="docutils literal notranslate"><span class="pre">pandas</span></code> code.  Its also less code (I’m a coder and inherently lazy!).  But note that both functions are equivalent and do the same thing!</p>
</section>
</section>
<section id="visualising-the-number-of-cases-over-time">
<h2>Visualising the number of cases over time.<a class="headerlink" href="#visualising-the-number-of-cases-over-time" title="Permalink to this headline">¶</a></h2>
<p>We will be looking at visualisation in more detail when we introduce <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>For now we will see how <code class="docutils literal notranslate"><span class="pre">pandas</span></code> includes a high level plotting API for <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>.</p>
<section id="but-first-more-wrangling">
<h3>But first…. more wrangling!<a class="headerlink" href="#but-first-more-wrangling" title="Permalink to this headline">¶</a></h3>
<p>The cleaned dataset is in what we might call a tidy or long format.  That is there are multiple metric entries per date for each province.  We can convert this into a “wide format”, where each metric has its own column per date and province using the <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> method.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> is quite a powerful function and there are plenty of options of how to use it.  I recommend experimenting with it on different dataset.  I’ve always found it useful for tasks similar to the below.</p>
</div></blockquote>
<p>The code below we convert the metric column into six columns: three columns for <code class="docutils literal notranslate"><span class="pre">n</span></code> (the daily count) and <code class="docutils literal notranslate"><span class="pre">n_cum</span></code> (the cumulative count).  We specify that using the <code class="docutils literal notranslate"><span class="pre">columns</span></code> parameter.  We are also creating a <code class="docutils literal notranslate"><span class="pre">MultiIndex</span></code> based on <code class="docutils literal notranslate"><span class="pre">['province',</span> <span class="pre">'province_code','date']</span></code>.  The order you choose here is important for how data is selected.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># wide format</span>
<span class="n">wf_covid</span> <span class="o">=</span> <span class="n">neth_covid</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;metric&#39;</span><span class="p">],</span> 
                                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;province&#39;</span><span class="p">,</span> <span class="s1">&#39;province_code&#39;</span><span class="p">,</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_covid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th colspan="3" halign="left">n</th>
      <th colspan="3" halign="left">n_cum</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th>metric</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
    </tr>
    <tr>
      <th>province</th>
      <th>province_code</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">Drenthe</th>
      <th rowspan="5" valign="top">22</th>
      <th>2020-02-27</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-28</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-29</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-01</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2020-03-02</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>What may not be obvious is that we now have a <code class="docutils literal notranslate"><span class="pre">pandas.Dataframe</span></code> with a multi-index.  The <code class="docutils literal notranslate"><span class="pre">.info()</span></code> method reveals the details:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_covid</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
MultiIndex: 3445 entries, (&#39;Drenthe&#39;, 22, Timestamp(&#39;2020-02-27 00:00:00&#39;)) to (&#39;overall&#39;, -1, Timestamp(&#39;2020-11-17 00:00:00&#39;))
Data columns (total 6 columns):
 #   Column                Non-Null Count  Dtype
---  ------                --------------  -----
 0   (n, deaths)           3445 non-null   int32
 1   (n, hosp_admit)       3445 non-null   int32
 2   (n, total_cases)      3445 non-null   int32
 3   (n_cum, deaths)       3445 non-null   int32
 4   (n_cum, hosp_admit)   3445 non-null   int32
 5   (n_cum, total_cases)  3445 non-null   int32
dtypes: int32(6)
memory usage: 105.8+ KB
</pre></div>
</div>
</div>
</div>
<p>Let’s take a scenario where we want to select data for the <code class="docutils literal notranslate"><span class="pre">Groningen</span></code> province of the Netherlands.  We can do this using <code class="docutils literal notranslate"><span class="pre">.loc</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the groningen data</span>
<span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Groningen&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="3" halign="left">n</th>
      <th colspan="3" halign="left">n_cum</th>
    </tr>
    <tr>
      <th></th>
      <th>metric</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
    </tr>
    <tr>
      <th>province_code</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">20</th>
      <th>2020-02-27</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-28</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-29</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-01</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-02</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This gives us the time series for just Groningen.  But note that we also have the <code class="docutils literal notranslate"><span class="pre">province_code</span></code> column included.  This is the 2nd level of the index - in fact it is redundant here as its value is unique for Groningen.  To remove it modify our indexing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the groningen data.  note that we use 2 keys inside brackets.</span>
<span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Groningen&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">n</th>
      <th colspan="3" halign="left">n_cum</th>
    </tr>
    <tr>
      <th>metric</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-02-27</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-28</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-29</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-01</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-02</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>columns are also a multi-index and we need to use indexing to narrow down the either the daily or cumulative counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Groningen&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MultiIndex([(    &#39;n&#39;,      &#39;deaths&#39;),
            (    &#39;n&#39;,  &#39;hosp_admit&#39;),
            (    &#39;n&#39;, &#39;total_cases&#39;),
            (&#39;n_cum&#39;,      &#39;deaths&#39;),
            (&#39;n_cum&#39;,  &#39;hosp_admit&#39;),
            (&#39;n_cum&#39;, &#39;total_cases&#39;)],
           names=[None, &#39;metric&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get daily cases</span>
<span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Groningen&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)][</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>metric</th>
      <th>deaths</th>
      <th>hosp_admit</th>
      <th>total_cases</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-02-27</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-28</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-02-29</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-01</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2020-03-02</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can easily plot one or more <code class="docutils literal notranslate"><span class="pre">Series</span></code> in a <code class="docutils literal notranslate"><span class="pre">Dataframe</span></code> by calling the <code class="docutils literal notranslate"><span class="pre">.plot</span></code> method.</p>
<blockquote>
<div><p>I tend to think of plot as a kitchen sink method.  Its accepts a very large number of <strong>optional</strong> parameters!  Check out the documentation <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.plot.html">here</a>.  In some ways this is bad practice when designing APIs, but it implementation does turn out to be very handy.</p>
</div></blockquote>
<p>I would argue that an absolute must is to specify the <code class="docutils literal notranslate"><span class="pre">figsize</span></code>.  For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pandas short hand for plotting daily cases</span>
<span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Groningen&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)][</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="s1">&#39;total_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;date&#39;&gt;
</pre></div>
</div>
<img alt="../../../_images/05_analysing_42_1.png" src="../../../_images/05_analysing_42_1.png" />
</div>
</div>
<p>With default settings in Jupyter you should see the following above the chart:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">AxesSubplot</span><span class="p">:</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This is because <code class="docutils literal notranslate"><span class="pre">.plot</span></code> returns a matplotlib axis object and the text above is the <code class="docutils literal notranslate"><span class="pre">__repr__</span></code>.  The object is very useful, but the print out isn’t! For now I’ll show you a couple of ways to avoid that appearing in your pristine notebooks.</p>
<p>The first is to assign the axis to a variable.  Convention is that the name <code class="docutils literal notranslate"><span class="pre">ax</span></code> is used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Groningen&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)][</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="s1">&#39;total_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/05_analysing_44_0.png" src="../../../_images/05_analysing_44_0.png" />
</div>
</div>
<p>The second approach is to use a semi-colon after the python statement.  I see this used a lot online.  I’m always a bit suspicious this is because the author doesn’t really understand what is really happening.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wf_covid</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="s1">&#39;Groningen&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)][</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="s1">&#39;total_cases&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/05_analysing_46_0.png" src="../../../_images/05_analysing_46_0.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "health-data-science-OR/coding-for-ml",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/02_stat_prog/01_pandas"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="04_datetimes.html" title="previous page">Managing time series</a>
    <a class='right-next' id="next-link" href="06_cs_combining.html" title="next page">Case study: Combining multiple sources</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Thomas Monks<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>