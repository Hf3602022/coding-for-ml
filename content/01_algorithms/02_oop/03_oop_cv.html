
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Case study: Cross-validation</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Scientific coding in numpy" href="../03_numpy.html" />
    <link rel="prev" title="Case study: ABS" href="02_oop_sim.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/small_logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../front_page.html">
   Preface
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/contributing.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/install.html">
   Install python and an IDE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/git.html">
   GitHub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/conda.html">
   Conda virtual environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../001_setup/docker.html">
   Docker
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Algorithms and computational modelling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01_design.html">
   The importance of design
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_design/01_primes.html">
     Computing prime numbers
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_design/02_better_design.html">
     Improving the prime sieve code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_design/03_micro_opt.html">
     Do micro-optimisations matter?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_design/04_summing_up.html">
     Summing up
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../02_oop.html">
   Designing using objects
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01_python_classes.html">
     A world of objects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02_oop_sim.html">
     Case study: ABS
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Case study: Cross-validation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03_numpy.html">
   Scientific coding in
   <code class="docutils literal notranslate">
    <span class="pre">
     numpy
    </span>
   </code>
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/01_performance.html">
     Arrays versus lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/02_vectors.html">
     Vectors and matricies
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/03_slicing.html">
     Array slicing and indexing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/04_algebra.html">
     Array algebra
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/05_statistics.html">
     Statistical procedures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/06_sampling.html">
     Random variables and simulation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/07_advanced_iter.html">
     Advanced Array Iteration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/08_cs1.html">
     Case study 1: a bootstrap routine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/09_cs2.html">
     Case study 2: prime sieve
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_numpy/10_cs3.html">
     Case study 3: online statistics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04_exercises.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_exercises/01_science_funcs.html">
     Coding scientific functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_exercises/02_basic_oop.html">
     Basic Object Orientated Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_exercises/02_array.html">
     Working with an
     <code class="docutils literal notranslate">
      <span class="pre">
       np.ndarray
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04_exercises/04_numpy_stats.html">
     Statistical procedures in
     <code class="docutils literal notranslate">
      <span class="pre">
       numpy
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05_debug.html">
   Debug challenges
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05_debug/01_debug_numpy.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       numpy
      </span>
     </code>
     debug
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../06_solutions.html">
   Solutions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../06_solutions/01_science_funcs.html">
     Coding scientific functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06_solutions/02_basic_oop.html">
     Basic Object Orientated Methods
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06_solutions/02_array.html">
     Working with an
     <code class="docutils literal notranslate">
      <span class="pre">
       np.ndarray
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../06_solutions/04_numpy_stats.html">
     Statistical procedures in
     <code class="docutils literal notranslate">
      <span class="pre">
       numpy
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistical Programming
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../02_stat_prog/01_pandas_front_page.html">
   Data wrangling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/01_pandas/01_intro_pandas.html">
     Introduction to
     <strong>
      <code class="docutils literal notranslate">
       <span class="pre">
        pandas
       </span>
      </code>
     </strong>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/01_pandas/02_files.html">
     Working with files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/01_pandas/03_non_standard_download.html">
     Case study: a large remote dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/01_pandas/04_datetimes.html">
     Managing time series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/01_pandas/05_analysing.html">
     Analysing real data sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/01_pandas/06_cs_combining.html">
     Case study: Combining multiple sources
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../02_stat_prog/02_visual_front_page.html">
   Visualising data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/02_matplotlib/01_matplotlib.html">
     Introduction to
     <code class="docutils literal notranslate">
      <span class="pre">
       Matplotlib
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/02_matplotlib/02_matplotlib2.html">
     Multiple subplots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/02_matplotlib/03_cs_hm.html">
     Case study: heat map
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/02_matplotlib/02_plotting_time_series.html">
     Case Study: ED Time Series
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../02_stat_prog/03_exercises_front_page.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/03_exercises/00_dataframes.html">
     Working with a
     <code class="docutils literal notranslate">
      <span class="pre">
       pandas.Dataframe
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/03_exercises/01_data_wrangling_matplotlib.html">
     ED data wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/03_exercises/02_stroke_data_wrangling.html">
     Stroke data wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/03_exercises/03_visualise_ts.html">
     Visualising time series data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../02_stat_prog/04_solutions_front_page.html">
   Solutions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/04_solutions/00_dataframes.html">
     Working with a
     <code class="docutils literal notranslate">
      <span class="pre">
       pandas.Dataframe
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/04_solutions/01_data_wrangling_matplotlib_solutions.html">
     ED Data Wrangling Exercises
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/04_solutions/02_stroke_data_wrangling_solutions.html">
     Stroke data wrangling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../02_stat_prog/04_solutions/03_visualise_ts_SOLUTIONS.html">
     Visualising time series data
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Managing Data Science Projects
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../03_mgt/03_vc_front_page.html">
   Version control
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/02_git.html">
     Introducing Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/03_cs_1.html">
     Case study: Basic use of Git
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/04_cs_2.html">
     Case study: roll back and bug fix
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/01_git/05_cs_3.html">
     Case study: Branching and merging
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../03_mgt/03_mgt_front_page.html">
   Deployment
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
  <label for="toctree-checkbox-12">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/02_packaging/01_python_packages.html">
     Local python packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/03_pypi/01_pypi.html">
     PyPi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_binder/01_binder.html">
     BinderHub
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../03_mgt/04_exercises_front_page.html">
   Exercises
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_exercises/01_python_packages.html">
     Python package exercise
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_exercises/02_conda.html">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       conda
      </span>
     </code>
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/04_exercises/03_binder.html">
     Binderhub exercises
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../03_mgt/05_solutions_front_page.html">
   Solutions
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
  <label for="toctree-checkbox-14">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../03_mgt/05_solutions/01_python_packages_solutions.html">
     Python package exercise
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../appendix/acknowledge.html">
   Acknowledgements
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendix Basic Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../appendix/fp_lectures.html">
   Lectures
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
  <label for="toctree-checkbox-15">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/lectures/Lecture1.html">
     Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/lectures/Lecture2.html">
     Conditionals and Loops
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../appendix/fp_practicals.html">
   Practicals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
  <label for="toctree-checkbox-16">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/01_basics.html">
     Basic Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/debug1.html">
     Debug challenge 1
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/02_basics.html">
     Conditionals and Loops
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../appendix/labs/debug2.html">
     Debug challenge 2
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/01_algorithms/02_oop/03_oop_cv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/health-data-science-OR/coding-for-ml"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/health-data-science-OR/coding-for-ml/issues/new?title=Issue%20on%20page%20%2Fcontent/01_algorithms/02_oop/03_oop_cv.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/health-data-science-OR/coding-for-ml/main?urlpath=lab/tree/content/01_algorithms/02_oop/03_oop_cv.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/health-data-science-OR/coding-for-ml/blob/main/content/01_algorithms/02_oop/03_oop_cv.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#synthetic-data">
   Synthetic data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#leave-one-out-cross-validation">
   Leave one out cross validation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-about-if-we-wanted-to-use-a-different-cross-validation-method">
   What about if we wanted to use a different cross validation method?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementing-a-kfold-class">
     Implementing a
     <code class="docutils literal notranslate">
      <span class="pre">
       KFold
      </span>
     </code>
     class
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kfold-split">
     <code class="docutils literal notranslate">
      <span class="pre">
       KFold.split()
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-kfold">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       KFold
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#abstract-classes">
   Abstract classes
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="case-study-cross-validation">
<h1>Case study: Cross-validation<a class="headerlink" href="#case-study-cross-validation" title="Permalink to this headline">¶</a></h1>
<p>In supervised learning studies we distinguish between the training and test error rates. The test error rate refers to the average performance of a model when predicting a new observation (data that was not used in the training of the model).  A useful model is one that can accurately predict new observations!</p>
<p>An issue in real ML studies is that data are expensive to collect and often a health data scientist doesn’t have as much validation data as they would ideally like for estimating the test error rate.  Cross-validation is a general term to describe a set of statistical methods for efficiently splitting a dataset in order to estimating the test error of a model.</p>
<p>Cross validation methods are a nice example of where python classes can be used to design a framework for your ML. In the case study we will explore creating two classes for cross validation in machine learning: <strong>Leave-One-Out Cross-Validation</strong> and <strong>K-Fold Cross Validation.</strong></p>
<blockquote>
<div><p>If you are interested to read further on cross validation I recommend the excellent: <strong>An introduction to statistical learning (with applications in R)</strong> by James, Witten, Hastie and Tibshirani.</p>
</div></blockquote>
<blockquote>
<div><blockquote>
<div><p>In a real machine learning study in python there is no doubt that you would implement these classes using a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array.  In practice I would therefore implement these classes slightly differently. We will cover <code class="docutils literal notranslate"><span class="pre">numpy</span> </code>in the next chapter.  Another bullet proof option, that requires no implementation, is to use the <code class="docutils literal notranslate"><span class="pre">sklearn.model_selection</span></code> namespace.  I’ve based the naming on sklearn’s interface here.  After you have completed the case study do check out the <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> source code that’s <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.LeaveOneOut.html#sklearn.model_selection.LeaveOneOut">available via its documentation</a>.</p>
</div></blockquote>
</div></blockquote>
<p>We’ll begin by creating each class independently.  Then we’ll work on our OOP design credentials by extracting what can be encapsulated into a common baseclass.  Finally we will take a short look at what is meant by an <strong>Abstract</strong> class and how this is implemented in Python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="synthetic-data">
<h2>Synthetic data<a class="headerlink" href="#synthetic-data" title="Permalink to this headline">¶</a></h2>
<p>The function below generates synthetic data that can be used to test the classes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                             <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generates a simple random synthetic dataset in a given shape.</span>
<span class="sd">    Used for testing of generator classes.</span>
<span class="sd">    </span>
<span class="sd">    X: each feature is a sequence i to i + n_samples where i is the feature no.</span>
<span class="sd">    y data is 0 or 1 weighted very roughly 50/50.</span>
<span class="sd">    </span>
<span class="sd">    These sequences are randomised if shuffle is set to True.</span>
<span class="sd">    </span>
<span class="sd">    No error checking. Assumes all inputs are valid.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    n_samples: int, optional (default=10)</span>
<span class="sd">        The number of samples</span>
<span class="sd">        </span>
<span class="sd">    n_features: int, optional (default=1)</span>
<span class="sd">        The number of features in the classification problem</span>
<span class="sd">        </span>
<span class="sd">    shuffle: bool, optional (default=False)</span>
<span class="sd">        If true then sequences are randomly shuffled</span>
<span class="sd">        </span>
<span class="sd">    random_seed: int or None, optional (default=None)</span>
<span class="sd">        If shuffle then controls the ordering of the sequences generated.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    X, y</span>
<span class="sd">    Where X and y are python lists and X will be a list of lists sized </span>
<span class="sd">    (n_samples, n_features) </span>
<span class="sd">        </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[[(</span><span class="n">col</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">))</span> <span class="o">+</span> <span class="n">row</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_features</span><span class="p">)]</span> 
                                          <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_samples</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">n_samples</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_samples</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)))</span>
    
    <span class="k">if</span> <span class="n">shuffle</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">]:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0], [1], [2]]
[1, 0, 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[0, 6], [1, 7], [2, 8], [3, 9], [4, 10], [5, 11]]
[1, 1, 1, 0, 0, 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[3, 9], [1, 7], [2, 8], [4, 10], [0, 6], [5, 11]]
[0, 1, 1, 0, 1, 0]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="leave-one-out-cross-validation">
<h2>Leave one out cross validation<a class="headerlink" href="#leave-one-out-cross-validation" title="Permalink to this headline">¶</a></h2>
<p>As it’s name suggests <strong>Leave on out cross validation (LOOCV)</strong> incrementally leaves one data point out of the training of a model.  It then predicts the single holdout sample.  This is repeated for every sample in the dataset.</p>
<blockquote>
<div><p>I’ve rarely seen this approach used in practice and its not a method I would consider using myself.  The reason is that it requires a lot of training cycles.  Combine LOOCV with parameter optimisation, a moderate sized dataset and a computationally intensive training routine and you’ll need to leave your code running overnight!  But its a nice simple example that we can use in our learning.</p>
</div></blockquote>
<p>Rather than perform both the generation of the splits <strong>and</strong> cross validation in the same class we will seperate their responsibilities into seperate classes.  We will have one class called <code class="docutils literal notranslate"><span class="pre">LeaveOneOut</span></code> and a function called <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code>.  The function will accept an instance of <code class="docutils literal notranslate"><span class="pre">LeaveOneOut</span></code> and use it to generate the data needed for cross validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LeaveOneOut</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Leave one out dataset generator for cross validation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;LeaveOneOut()&#39;</span>

    <span class="k">def</span> <span class="nf">get_n_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The number of splits returned by the cross validation</span>
<span class="sd">        method.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generator method.  Split the dataset</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
        
            <span class="c1"># training data indexes</span>
            <span class="n">train_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">test_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">train_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">test_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">test_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            
            <span class="c1"># test data</span>
            <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
            
            <span class="k">yield</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span>
</pre></div>
</div>
</div>
</div>
<p>I will use the <code class="docutils literal notranslate"><span class="pre">synthetic_classification</span></code> to generate a test dataset for <code class="docutils literal notranslate"><span class="pre">LeaveOneOut</span></code>.  I will keep the inputs as a sequence so you can easily see it working.</p>
<blockquote>
<div><p>Remember that <code class="docutils literal notranslate"><span class="pre">LeaveOneOut.split()</span></code> uses the <strong>yield</strong> keyword.  This means it is a <strong>generator</strong> method and we need to call it repeatedly in a loop in order to generate new splits for validation.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate test dataset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># create an instance of LeaveOneOut</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">LeaveOneOut</span><span class="p">()</span>

<span class="c1"># basic cross validation loop.</span>
<span class="c1"># I&#39;ve zipped together a range and the splits into order to get fold no.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">split_data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
    <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">split_data</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Fold </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">Train:</span><span class="se">\t</span><span class="s1">X:</span><span class="si">{</span><span class="n">train_X</span><span class="si">}</span><span class="s1">, y:</span><span class="si">{</span><span class="n">train_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test:</span><span class="se">\t</span><span class="s1">X:</span><span class="si">{</span><span class="n">test_X</span><span class="si">}</span><span class="s1">, y:</span><span class="si">{</span><span class="n">test_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold 1:
Train:	X:[[1, 7], [2, 8], [3, 9], [4, 10], [5, 11]], y:[1, 1, 0, 0, 0]
Test:	X:[0, 6], y:1
Fold 2:
Train:	X:[[0, 6], [2, 8], [3, 9], [4, 10], [5, 11]], y:[1, 1, 0, 0, 0]
Test:	X:[1, 7], y:1
Fold 3:
Train:	X:[[0, 6], [1, 7], [3, 9], [4, 10], [5, 11]], y:[1, 1, 0, 0, 0]
Test:	X:[2, 8], y:1
Fold 4:
Train:	X:[[0, 6], [1, 7], [2, 8], [4, 10], [5, 11]], y:[1, 1, 1, 0, 0]
Test:	X:[3, 9], y:0
Fold 5:
Train:	X:[[0, 6], [1, 7], [2, 8], [3, 9], [5, 11]], y:[1, 1, 1, 0, 0]
Test:	X:[4, 10], y:0
Fold 6:
Train:	X:[[0, 6], [1, 7], [2, 8], [3, 9], [4, 10]], y:[1, 1, 1, 0, 0]
Test:	X:[5, 11], y:0
</pre></div>
</div>
</div>
</div>
<p>Now let’s create a function to perform the cross validation.</p>
<blockquote>
<div><p>This could easily be another class.  But for simplicity I’ve used a function.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">):</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;split=&gt; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">split_data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">,&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">split_data</span>
        <span class="c1"># model fitting, prediction and accuracy assesment is</span>
        <span class="c1"># just simulated here.</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">LeaveOneOut</span><span class="p">())</span>

<span class="c1"># print out fake accuracy!</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cv score: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>split=&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, end
cv score: 0.90
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="what-about-if-we-wanted-to-use-a-different-cross-validation-method">
<h2>What about if we wanted to use a different cross validation method?<a class="headerlink" href="#what-about-if-we-wanted-to-use-a-different-cross-validation-method" title="Permalink to this headline">¶</a></h2>
<p>The second cross validation method on the menu is <strong>k-fold</strong> cross validation where <span class="math notranslate nohighlight">\(k\)</span> is typically set to 5 or 10. K-fold cross validation is therefore less computationally demanding than LOOCV. Here we will shuffle the dataset and then split it into k segments.  In each loop of our cross validation a model is trained on <span class="math notranslate nohighlight">\(k-1\)</span> segments while the final one is held out for testing.</p>
<p>We will implement <code class="docutils literal notranslate"><span class="pre">KFold</span></code> so that it has the same <strong>interface</strong> as <code class="docutils literal notranslate"><span class="pre">LeaveOneOut</span></code>.  This means it has the a set of method signatures and properties in common with <code class="docutils literal notranslate"><span class="pre">LeaveOneOut</span></code>.  It will have the following method signatures in common:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_n_splits(self,</span> <span class="pre">X)</span></code> - this is a generator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split(self,</span> <span class="pre">X,</span> <span class="pre">y)</span></code> - returns an int</p></li>
</ul>
<div class="section" id="implementing-a-kfold-class">
<h3>Implementing a <code class="docutils literal notranslate"><span class="pre">KFold</span></code> class<a class="headerlink" href="#implementing-a-kfold-class" title="Permalink to this headline">¶</a></h3>
<p>The implementation of <code class="docutils literal notranslate"><span class="pre">KFold</span></code> is slightly more involved than LOOCV, but it is perfectly possible in standard python using either <code class="docutils literal notranslate"><span class="pre">for</span></code> loops or list comprehensions. I’ve opted for the latter as it allows a proportion of the logic to be expressed in a single (I would argue readable) line of python.</p>
<p>First take a look at the class and then I’ll spend a bit of time explaining how it works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">KFold</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A generator class for k-fold cross validation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="n">shuffle</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;KFold(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="si">=}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="si">=}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="si">=}</span><span class="s1">)&#39;</span>
    
    
    <span class="k">def</span> <span class="nf">get_n_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return an integer representing the number of splits that </span>
<span class="sd">        will be generated.</span>
<span class="sd">    </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
    
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generator method.  Returns incremental splits of the dataset</span>
<span class="sd">        on each call.</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        X: list</span>
<span class="sd">            python list containing X data. For multiple features</span>
<span class="sd">            shape should be (n_samples, n_features)</span>
<span class="sd">        </span>
<span class="sd">        y: list</span>
<span class="sd">            python list containing y target data. For multiple </span>
<span class="sd">            targets shape should be (n_samples, n_targets)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        train_X, test_X, train_y, test_y </span>
<span class="sd">        </span>
<span class="sd">        Where each is a python list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="c1"># store the indexes of each element </span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">indicies</span><span class="p">)</span>
        
        <span class="c1"># length of k - 1 splits... final split continues to end.</span>
        <span class="n">split_len</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">test_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">split_len</span><span class="p">):</span>
        
            <span class="c1"># create k - 1 training folds for X </span>
            <span class="n">train_X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fold_training_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">split_len</span><span class="p">)</span>
            <span class="c1"># X test data for fold</span>
            <span class="n">test_X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="o">+</span> <span class="n">split_len</span><span class="p">)]</span>
            
            <span class="c1"># create k - 1 training segments for y</span>
            <span class="n">train_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fold_training_data</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">split_len</span><span class="p">)</span>
            <span class="c1"># y test data fold</span>
            <span class="n">test_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="o">+</span> <span class="n">split_len</span><span class="p">)]</span>
            
            <span class="k">yield</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_y</span>
            
        
    <span class="k">def</span> <span class="nf">_fold_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">,</span> <span class="n">split_len</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        create training segments for X or y</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">train_seg1</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_idx</span><span class="p">)]</span>
        <span class="n">train_seg2</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">test_idx</span> <span class="o">+</span> <span class="n">split_len</span><span class="p">),</span> 
                                                 <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>                                
        <span class="k">return</span> <span class="n">train_seg1</span> <span class="o">+</span> <span class="n">train_seg2</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="kfold-split">
<h3><code class="docutils literal notranslate"><span class="pre">KFold.split()</span></code><a class="headerlink" href="#kfold-split" title="Permalink to this headline">¶</a></h3>
<p>In the <code class="docutils literal notranslate"><span class="pre">split()</span></code> method you should note that I do not directly randomise the <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> list parameters (containing the training data). I do not directly modify these lists because it will also modify the variables pointing to the same data outside of the class (its the same data because of the way python passes a list to a function).</p>
<p>Here’s a simple function <code class="docutils literal notranslate"><span class="pre">modify_list</span></code> that illustrates what happens when you modify a list passed as a parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">modify_list</span><span class="p">(</span><span class="n">to_modify</span><span class="p">):</span>
    <span class="n">to_modify</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;shrubbery&#39;</span><span class="p">)</span>
    <span class="n">to_modify</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;another shrubbery&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;inside function </span><span class="si">{</span><span class="n">to_modify</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
    
<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;knights&#39;</span><span class="p">,</span> <span class="s1">&#39;who&#39;</span><span class="p">,</span> <span class="s1">&#39;say&#39;</span><span class="p">,</span> <span class="s1">&#39;ni&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Outside function BEFORE call </span><span class="si">{</span><span class="n">lst</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">modify_list</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Outside function AFTER call </span><span class="si">{</span><span class="n">lst</span><span class="si">=}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Outside function BEFORE call lst=[&#39;knights&#39;, &#39;who&#39;, &#39;say&#39;, &#39;ni&#39;]
inside function to_modify=[&#39;knights&#39;, &#39;who&#39;, &#39;say&#39;, &#39;ni&#39;, &#39;shrubbery&#39;, &#39;another shrubbery&#39;]
Outside function AFTER call lst=[&#39;knights&#39;, &#39;who&#39;, &#39;say&#39;, &#39;ni&#39;, &#39;shrubbery&#39;, &#39;another shrubbery&#39;]
</pre></div>
</div>
</div>
</div>
<p>In my implementation you will see that I first create <code class="docutils literal notranslate"><span class="pre">idx</span></code> which is a simple integer list 0 to <code class="docutils literal notranslate"><span class="pre">len(X)</span></code>.  I then shuffle the indexes and use them to create a new list via a comprehension.  For example to create the test data</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_X</span> <span class="o">=</span> <span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">test_idx</span><span class="p">,</span> <span class="n">test_idx</span> <span class="o">+</span> <span class="n">split_len</span><span class="p">)]</span>
</pre></div>
</div>
<p>A key bit of code in the comprehension is <code class="docutils literal notranslate"><span class="pre">X[idx[i]]</span></code>.  Let’s say that we have</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">,</span> <span class="mi">1_000_000</span><span class="p">]</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">=</span> <span class="pre">2</span></code> then <code class="docutils literal notranslate"><span class="pre">idx[2]</span></code> would evaluate to <code class="docutils literal notranslate"><span class="pre">0</span></code>.  <code class="docutils literal notranslate"><span class="pre">X[idx[2]</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">10</span></code>.  You can think of this technique as an indirect lookup of your data.</p>
<p>In the above example the reordered data is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reordered_X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">]</span>
</pre></div>
</div>
<blockquote>
<div><p>I chose to use a list of indexes, but you could also <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">copy</span></code> and use <code class="docutils literal notranslate"><span class="pre">internal_X</span> <span class="pre">=</span> <span class="pre">copy.copy(X)</span></code> to achieve the same results - that might even be clearer to read and understand.  You may also not care about modifying the data your assigned to your external variable.  Personally I think that modifying in place is bad practice and will may lead to unintended <strong>silent</strong> side-effects and bugs in your code at a later date.</p>
</div></blockquote>
</div>
<div class="section" id="using-kfold">
<h3>Using <code class="docutils literal notranslate"><span class="pre">KFold</span></code><a class="headerlink" href="#using-kfold" title="Permalink to this headline">¶</a></h3>
<p>As KFold implements the same interface as <code class="docutils literal notranslate"><span class="pre">LeaveOneOut</span></code> we can reuse <code class="docutils literal notranslate"><span class="pre">cross_validate</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">KFold</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>

<span class="c1"># print out fake accuracy!</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cv score: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>split=&gt; 1, 2, 3, 4, 5, end
cv score: 0.85
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="abstract-classes">
<h2>Abstract classes<a class="headerlink" href="#abstract-classes" title="Permalink to this headline">¶</a></h2>
<p>The two classes we have put together is the start of a small framework for cross validation. Its important to recognise that the moment you develop a framework of classes you hit problems - understanding, maintenance, and extension!  Here’s a few scenarios where you might hit problems:</p>
<ul class="simple">
<li><p>When you have a large number of classes to generate splits for cross validation it becomes difficult to keep these all in your head!  A far simpler concept is the idea of a <code class="docutils literal notranslate"><span class="pre">SplitGenerator</span></code>.</p></li>
<li><p>Other data scientists, in your team or elsewhere, might want to add their own custom classes to use in place of yours.  Its likely that you want to control this to a certain extent to avoid crashes and improve the experience of your fellow data scientists.</p></li>
</ul>
<p>In python, to an extent, you can provide this control via a concept called <strong>Abstract base classes</strong>. These are strange beasts!  Here’s one for generating our CV splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">AbstractSplitGenerator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract base class for generating splits of X, y data</span>
<span class="sd">    for machine learning cross validation. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_n_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>The first line of code imports <code class="docutils literal notranslate"><span class="pre">ABC</span></code> and <code class="docutils literal notranslate"><span class="pre">abstractmethod</span></code> from the built in module <code class="docutils literal notranslate"><span class="pre">abc</span></code>.  This gives us the ingredients we need for creating the base class.  The first step is to tell python that this is a abstract class by subclassing <code class="docutils literal notranslate"><span class="pre">ABC</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AbstractSplitGenerator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>It is not possible to create an instance of <code class="docutils literal notranslate"><span class="pre">AbstractSplitGenerator</span></code>.  Try it!  Python won’t let you.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv</span> <span class="o">=</span> <span class="n">AbstractSplitGenerator</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_433104</span><span class="o">/</span><span class="mf">2482074630.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">AbstractSplitGenerator</span><span class="p">()</span>

<span class="ne">TypeError</span>: Can&#39;t instantiate abstract class AbstractSplitGenerator with abstract methods get_n_splits, split
</pre></div>
</div>
</div>
</div>
<p>In the class body we have defined two <strong>abstract methods</strong> using the <code class="docutils literal notranslate"><span class="pre">&#64;abstractmethod</span></code> decorator.  This decorator <strong>forces</strong> any subclass of <code class="docutils literal notranslate"><span class="pre">AbstractSplitGenerator</span></code> to implement these methods.  Otherwise we get a run time error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DodgyImplementation</span><span class="p">(</span><span class="n">AbstractSplitGenerator</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">DodgyImplementation</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_433104</span><span class="o">/</span><span class="mf">1287983807.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="k">pass</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">DodgyImplementation</span><span class="p">()</span>

<span class="ne">TypeError</span>: Can&#39;t instantiate abstract class DodgyImplementation with abstract methods get_n_splits, split
</pre></div>
</div>
</div>
</div>
<p>The style of Abstract classes I have shown you here is akin to interface based inheritance from other languages.  Its a neat way to use inheritance without introducing logic bugs from higher up the class tree (as there is no logic code).  You can think of it as a weak “contract”.  If you want to write a class in this framework then you guarantee that you provide the methods that other code expects.</p>
<p>I specifically called this a <strong>weak</strong> contract above.  This is because in python almost anything goes!  If you want to enforce your contract you need to modify <code class="docutils literal notranslate"><span class="pre">cross_validation</span></code> to check the type of <code class="docutils literal notranslate"><span class="pre">cv</span></code>.  For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">):</span>
    
    <span class="c1"># enforce interface</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cv</span><span class="p">,</span> <span class="n">AbstractSplitGenerator</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected cv to be AbstractSplitGenerator, &#39;</span>
                        <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;but found </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;split=&gt; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">split_data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">get_n_splits</span><span class="p">(</span><span class="n">X</span><span class="p">)),</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">,&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">split_data</span>
        <span class="c1"># model fitting, prediction and accuracy assesment is</span>
        <span class="c1"># just simulated here.</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">LeaveOneOut</span><span class="p">())</span>

<span class="c1"># print out fake accuracy!</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cv score: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_433104</span><span class="o">/</span><span class="mf">696997810.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">LeaveOneOut</span><span class="p">())</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># print out fake accuracy!</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cv score: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nn">/tmp/ipykernel_433104/2306781539.py</span> in <span class="ni">cross_validate</span><span class="nt">(X, y, cv)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="c1"># enforce interface</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cv</span><span class="p">,</span> <span class="n">AbstractSplitGenerator</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">5</span>         <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Expected cv to be AbstractSplitGenerator, &#39;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>                         <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;but found </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">cv</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> 

<span class="ne">TypeError</span>: Expected cv to be AbstractSplitGenerator, but found &lt;class &#39;__main__.LeaveOneOut&#39;&gt;
</pre></div>
</div>
</div>
</div>
<p>You then simply create concrete classes by subclassing AbstractSplitGenerator. For example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LeaveOneOut</span><span class="p">(</span><span class="n">AbstractSplitGenerator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Leave one out dataset generator for cross validation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;LeaveOneOut()&#39;</span>

    <span class="k">def</span> <span class="nf">get_n_splits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The number of splits returned by the cross validation</span>
<span class="sd">        method.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generator method.  Split the dataset</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">test_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
        
            <span class="c1"># training data indexes</span>
            <span class="n">train_X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">test_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">train_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">test_index</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">test_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            
            <span class="c1"># test data</span>
            <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">test_index</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">test_index</span><span class="p">]</span>
            
            <span class="k">yield</span> <span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_X</span><span class="p">,</span> <span class="n">test_y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">synthetic_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">160</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">LeaveOneOut</span><span class="p">())</span>

<span class="c1"># print out fake accuracy!</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cv score: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>split=&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, end
cv score: 0.90
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "health-data-science-OR/coding-for-ml",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/01_algorithms/02_oop"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="02_oop_sim.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Case study: ABS</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="../03_numpy.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Scientific coding in <code class="docutils literal notranslate"><span class="pre">numpy</span></code></p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Thomas Monks<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>